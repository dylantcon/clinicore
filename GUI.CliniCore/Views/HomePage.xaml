<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:GUI.CliniCore.ViewModels"
             xmlns:views="clr-namespace:GUI.CliniCore.Views"
             xmlns:icons="clr-namespace:GUI.CliniCore.Resources.Fonts"
             x:Class="GUI.CliniCore.Views.HomePage"
             Title="{Binding Title}">

    <!-- Configure Shell back button to trigger Logout command -->
    <Shell.BackButtonBehavior>
        <BackButtonBehavior Command="{Binding LogoutCommand}"/>
    </Shell.BackButtonBehavior>

    <ContentPage.Resources>
        <ResourceDictionary>

            <!-- Administrator Template -->
            <DataTemplate x:Key="AdministratorTemplate" x:DataType="viewModels:AdministratorHomeViewModel">
                <ScrollView>
                    <VerticalStackLayout Padding="20" Spacing="15" MaximumWidthRequest="1200" HorizontalOptions="Center">

                        <!-- Welcome Section -->
                        <Border Stroke="#D32F2F" StrokeThickness="2" Background="#FFEBEE" StrokeShape="RoundRectangle 12" Padding="20">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="{Binding WelcomeMessage}" FontSize="24" FontAttributes="Bold" TextColor="#D32F2F"/>
                                <Label Text="Administrator Dashboard" FontSize="14" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </Border>

                        <Label Text="System Management" FontSize="18" FontAttributes="Bold" Margin="0,10,0,5"/>

                        <!-- Two-Column Grid Layout -->
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,*" RowSpacing="15" ColumnSpacing="15">

                            <!-- Column 0, Row 0: User Management -->
                            <Border Grid.Row="0" Grid.Column="0" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.Group}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#9C27B0" VerticalOptions="Center"/>
                                        <Label Text="User Management" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Manage all system users and permissions" FontSize="12" TextColor="Gray"/>
                                    <Button Text="Manage Users" Command="{Binding ManageUsersCommand}" BackgroundColor="#9C27B0" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Column 1, Row 0: Physician Management -->
                            <Border Grid.Row="0" Grid.Column="1" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.LocalHospital}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#2196F3" VerticalOptions="Center"/>
                                        <Label Text="Physician Management" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Manage physician profiles and credentials" FontSize="12" TextColor="Gray"/>
                                    <Button Text="Manage Physicians" Command="{Binding ManagePhysiciansCommand}" BackgroundColor="#2196F3" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Column 0, Row 1: Patient Management -->
                            <Border Grid.Row="1" Grid.Column="0" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.PersonAdd}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#4CAF50" VerticalOptions="Center"/>
                                        <Label Text="Patient Management" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Manage patient profiles and records" FontSize="12" TextColor="Gray"/>
                                    <Button Text="Manage Patients" Command="{Binding ManagePatientsCommand}" BackgroundColor="#4CAF50" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Column 1, Row 1: Clinical Documents -->
                            <Border Grid.Row="1" Grid.Column="1" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.Description}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#00BCD4" VerticalOptions="Center"/>
                                        <Label Text="Clinical Documents" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Access all clinical documentation" FontSize="12" TextColor="Gray"/>
                                    <Button Text="View Documents" Command="{Binding ViewClinicalDocumentsCommand}" BackgroundColor="#00BCD4" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Column 0, Row 2: Scheduling -->
                            <Border Grid.Row="2" Grid.Column="0" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.CalendarToday}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#FF9800" VerticalOptions="Center"/>
                                        <Label Text="Scheduling" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Manage appointments and schedules" FontSize="12" TextColor="Gray"/>
                                    <Button Text="View Scheduling" Command="{Binding ViewSchedulingCommand}" BackgroundColor="#FF9800" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Column 1, Row 2: System Administration (Stub) -->
                            <Border Grid.Row="2" Grid.Column="1" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.Settings}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#607D8B" VerticalOptions="Center"/>
                                        <Label Text="System Administration" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Multi-facility management (not available)" FontSize="12" TextColor="Gray"/>
                                    <Button Text="System Settings" Command="{Binding SystemAdminCommand}" BackgroundColor="#607D8B" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                            <!-- Column 0, Row 3: Reports (Stub) -->
                            <Border Grid.Row="3" Grid.Column="0" Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                                <VerticalStackLayout Spacing="8">
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="{x:Static icons:MaterialIcons.Assignment}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#673AB7" VerticalOptions="Center"/>
                                        <Label Text="Reports" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                    <Label Text="Statistical reports and analytics (stub)" FontSize="12" TextColor="Gray"/>
                                    <Button Text="View Reports" Command="{Binding ViewReportsCommand}" BackgroundColor="#673AB7" TextColor="White" Margin="0,8,0,0"/>
                                </VerticalStackLayout>
                            </Border>

                        </Grid>

                        <Button Text="Logout" Command="{Binding LogoutCommand}" BackgroundColor="#F44336" TextColor="White" Margin="0,20,0,0" HeightRequest="50" CornerRadius="8"/>

                        <CollectionView ItemsSource="{Binding ValidationErrors}" IsVisible="{Binding HasValidationErrors}" Margin="0,10,0,0">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding .}" TextColor="DarkOrange" FontSize="12" Margin="0,2"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </ScrollView>
            </DataTemplate>

            <!-- Physician Template -->
            <DataTemplate x:Key="PhysicianTemplate" x:DataType="viewModels:PhysicianHomeViewModel">
                <ScrollView>
                    <VerticalStackLayout Padding="20" Spacing="15" MaximumWidthRequest="900" HorizontalOptions="Center">

                        <Border Stroke="#1976D2" StrokeThickness="2" Background="#E3F2FD" StrokeShape="RoundRectangle 12" Padding="20">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="{Binding WelcomeMessage}" FontSize="24" FontAttributes="Bold" TextColor="#1976D2"/>
                                <Label Text="Physician Dashboard" FontSize="14" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </Border>

                        <Label Text="Clinical Workflow" FontSize="18" FontAttributes="Bold" Margin="0,10,0,5"/>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.Group}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#4CAF50" VerticalOptions="Center"/>
                                    <Label Text="My Patients" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="View and manage your patient roster" FontSize="12" TextColor="Gray"/>
                                <Button Text="View Patients" Command="{Binding ViewMyPatientsCommand}" BackgroundColor="#4CAF50" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.CalendarToday}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#2196F3" VerticalOptions="Center"/>
                                    <Label Text="My Schedule" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="View appointments and manage your calendar" FontSize="12" TextColor="Gray"/>
                                <Button Text="View Schedule" Command="{Binding ViewMyScheduleCommand}" BackgroundColor="#2196F3" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.Description}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#FF9800" VerticalOptions="Center"/>
                                    <Label Text="Clinical Documentation" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="Create and update clinical documents" FontSize="12" TextColor="Gray"/>
                                <Button Text="Create Document" Command="{Binding CreateClinicalDocumentCommand}" BackgroundColor="#FF9800" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.Schedule}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#9C27B0" VerticalOptions="Center"/>
                                    <Label Text="Manage Availability" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="Set your working hours and availability (coming soon)" FontSize="12" TextColor="Gray"/>
                                <Button Text="Set Availability" Command="{Binding ManageAvailabilityCommand}" BackgroundColor="#9C27B0" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Button Text="Logout" Command="{Binding LogoutCommand}" BackgroundColor="#F44336" TextColor="White" Margin="0,20,0,0" HeightRequest="50" CornerRadius="8"/>

                        <CollectionView ItemsSource="{Binding ValidationErrors}" IsVisible="{Binding HasValidationErrors}" Margin="0,10,0,0">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding .}" TextColor="DarkOrange" FontSize="12" Margin="0,2"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </ScrollView>
            </DataTemplate>

            <!-- Patient Template -->
            <DataTemplate x:Key="PatientTemplate" x:DataType="viewModels:PatientHomeViewModel">
                <ScrollView>
                    <VerticalStackLayout Padding="20" Spacing="15" MaximumWidthRequest="900" HorizontalOptions="Center">

                        <Border Stroke="#4CAF50" StrokeThickness="2" Background="#E8F5E9" StrokeShape="RoundRectangle 12" Padding="20">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="{Binding WelcomeMessage}" FontSize="24" FontAttributes="Bold" TextColor="#4CAF50"/>
                                <Label Text="Patient Portal" FontSize="14" TextColor="Gray"/>
                            </VerticalStackLayout>
                        </Border>

                        <Label Text="My Health" FontSize="18" FontAttributes="Bold" Margin="0,10,0,5"/>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.Event}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#2196F3" VerticalOptions="Center"/>
                                    <Label Text="My Appointments" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="View and manage your appointments" FontSize="12" TextColor="Gray"/>
                                <Button Text="View Appointments" Command="{Binding ViewMyAppointmentsCommand}" BackgroundColor="#2196F3" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.Description}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#FF9800" VerticalOptions="Center"/>
                                    <Label Text="My Clinical Documents" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="Access your medical records and documents" FontSize="12" TextColor="Gray"/>
                                <Button Text="View Documents" Command="{Binding ViewMyClinicalDocumentsCommand}" BackgroundColor="#FF9800" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Border Stroke="LightGray" StrokeThickness="1" Background="White" StrokeShape="RoundRectangle 8" Padding="15">
                            <VerticalStackLayout Spacing="8">
                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{x:Static icons:MaterialIcons.LocalHospital}" FontFamily="MaterialIconsRegular" FontSize="24" TextColor="#4CAF50" VerticalOptions="Center"/>
                                    <Label Text="My Care Team" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                <Label Text="View your assigned physicians" FontSize="12" TextColor="Gray"/>
                                <Button Text="View Physicians" Command="{Binding ViewMyPhysiciansCommand}" BackgroundColor="#4CAF50" TextColor="White" Margin="0,8,0,0"/>
                            </VerticalStackLayout>
                        </Border>

                        <Button Text="Logout" Command="{Binding LogoutCommand}" BackgroundColor="#F44336" TextColor="White" Margin="0,20,0,0" HeightRequest="50" CornerRadius="8"/>

                        <CollectionView ItemsSource="{Binding ValidationErrors}" IsVisible="{Binding HasValidationErrors}" Margin="0,10,0,0">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding .}" TextColor="DarkOrange" FontSize="12" Margin="0,2"/>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </ScrollView>
            </DataTemplate>

            <!-- Template Selector -->
            <views:RoleBasedContentTemplateSelector x:Key="RoleSelector"
                AdministratorTemplate="{StaticResource AdministratorTemplate}"
                PhysicianTemplate="{StaticResource PhysicianTemplate}"
                PatientTemplate="{StaticResource PatientTemplate}"/>

        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- Use ContentView with manual template binding -->
    <ContentView x:Name="RoleContentView" BindingContext="{Binding}"/>

</ContentPage>
