<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:GUI.CliniCore.ViewModels"
             xmlns:icons="clr-namespace:GUI.CliniCore.Resources.Fonts"
             xmlns:bootstrap="clr-namespace:Core.CliniCore.Bootstrap;assembly=Core.CliniCore"
             x:Class="GUI.CliniCore.Views.LoginPage"
             x:DataType="viewModels:LoginViewModel"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#F5F5F5">

    <ScrollView>
        <Grid RowDefinitions="*,Auto,*" Padding="20">

            <!-- Login Card -->
            <Border Grid.Row="1"
                    Stroke="#E0E0E0"
                    StrokeThickness="1"
                    Background="White"
                    StrokeShape="RoundRectangle 16"
                    Shadow="{Shadow Brush=Black, Opacity=0.1, Radius=10, Offset='0,2'}"
                    MaximumWidthRequest="450"
                    HorizontalOptions="Center"
                    Padding="40,40,40,30">

                <VerticalStackLayout Spacing="20">

                    <!-- Logo/Header -->
                    <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                        <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Label Text="{x:Static icons:MaterialIcons.LocalHospital}"
                                   FontFamily="MaterialIconsRegular"
                                   FontSize="40"
                                   TextColor="#1976D2"
                                   VerticalOptions="Center"/>
                            <Label Text="CliniCore"
                                   FontSize="32"
                                   FontAttributes="Bold"
                                   TextColor="#1976D2"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>

                        <Label Text="Medical Records Management System"
                               FontSize="13"
                               HorizontalOptions="Center"
                               TextColor="Gray"/>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1" Color="#E0E0E0" Margin="0,10,0,10"/>

                    <!-- Username Entry -->
                    <VerticalStackLayout Spacing="5">
                        <HorizontalStackLayout Spacing="6">
                            <Label Text="{x:Static icons:MaterialIcons.Person}"
                                   FontFamily="MaterialIconsRegular"
                                   FontSize="16"
                                   TextColor="#666"
                                   VerticalOptions="Center"/>
                            <Label Text="Username"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="#666"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Border Stroke="#BDBDBD"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 8"
                                Background="White">
                            <Entry Text="{Binding Username, Mode=TwoWay}"
                                   Placeholder="Enter your username"
                                   ReturnType="Next"
                                   Margin="12,8"
                                   TextColor="#333"
                                   PlaceholderColor="#999"/>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Password Entry -->
                    <VerticalStackLayout Spacing="5">
                        <HorizontalStackLayout Spacing="6">
                            <Label Text="{x:Static icons:MaterialIcons.Lock}"
                                   FontFamily="MaterialIconsRegular"
                                   FontSize="16"
                                   TextColor="#666"
                                   VerticalOptions="Center"/>
                            <Label Text="Password"
                                   FontSize="12"
                                   FontAttributes="Bold"
                                   TextColor="#666"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Border Stroke="#BDBDBD"
                                StrokeThickness="1"
                                StrokeShape="RoundRectangle 8"
                                Background="White">
                            <Entry Text="{Binding Password, Mode=TwoWay}"
                                   Placeholder="Enter your password"
                                   IsPassword="True"
                                   ReturnType="Done"
                                   Margin="12,8"
                                   TextColor="#333"
                                   PlaceholderColor="#999"/>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Validation Errors -->
                    <CollectionView ItemsSource="{Binding ValidationErrors}"
                                    IsVisible="{Binding HasValidationErrors}"
                                    Margin="0,5,0,0">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="#F44336"
                                        StrokeThickness="1"
                                        Background="#FFEBEE"
                                        StrokeShape="RoundRectangle 6"
                                        Margin="0,2"
                                        Padding="12,8">
                                    <Label Text="{Binding .}"
                                           TextColor="#D32F2F"
                                           FontSize="12"/>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Validation Warnings -->
                    <CollectionView ItemsSource="{Binding ValidationWarnings}"
                                    IsVisible="{Binding HasValidationWarnings}"
                                    Margin="0,5,0,0">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="#FF9800"
                                        StrokeThickness="1"
                                        Background="#FFF3E0"
                                        StrokeShape="RoundRectangle 6"
                                        Margin="0,2"
                                        Padding="12,8">
                                    <Label Text="{Binding .}"
                                           TextColor="#F57C00"
                                           FontSize="12"/>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Login Button -->
                    <Button Text="Sign In"
                            Command="{Binding LoginCommand}"
                            BackgroundColor="#1976D2"
                            TextColor="White"
                            FontAttributes="Bold"
                            FontSize="16"
                            Margin="0,10,0,0"
                            HeightRequest="50"
                            CornerRadius="8"
                            Shadow="{Shadow Brush=#1976D2, Opacity=0.3, Radius=8, Offset='0,2'}"/>

                    <!-- Clear Button -->
                    <Button Text="Clear Form"
                            Command="{Binding CancelCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#666"
                            BorderColor="#BDBDBD"
                            BorderWidth="1"
                            HeightRequest="45"
                            CornerRadius="8"/>

                    <!-- Development Credentials (visible in debug builds) -->
                    <Border x:Name="DevCredentialsBorder"
                            Stroke="#64B5F6"
                            StrokeThickness="1"
                            Background="#E3F2FD"
                            StrokeShape="RoundRectangle 8"
                            Margin="0,10,0,0"
                            Padding="12"
                            IsVisible="False">
                        <VerticalStackLayout Spacing="8">
                            <HorizontalStackLayout Spacing="6">
                                <Label Text="{x:Static icons:MaterialIcons.Info}"
                                       FontFamily="MaterialIconsRegular"
                                       FontSize="16"
                                       TextColor="#1976D2"
                                       VerticalOptions="Center"/>
                                <Label Text="Development Credentials"
                                       FontAttributes="Bold"
                                       FontSize="12"
                                       TextColor="#1976D2"
                                       VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="80,*" RowSpacing="4">
                                <Label Grid.Row="0" Grid.Column="0" Text="Admin:" FontSize="11" FontAttributes="Bold" TextColor="#333"/>
                                <Label Grid.Row="0" Grid.Column="1" FontSize="11" TextColor="#333">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{x:Static bootstrap:SampleCredentials.AdminUsername}" TextColor="#333"/>
                                            <Span Text=" / " TextColor="#333"/>
                                            <Span Text="{x:Static bootstrap:SampleCredentials.AdminPassword}" TextColor="#333"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label Grid.Row="1" Grid.Column="0" Text="Physician:" FontSize="11" FontAttributes="Bold" TextColor="#333"/>
                                <Label Grid.Row="1" Grid.Column="1" FontSize="11" TextColor="#333">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{x:Static bootstrap:SampleCredentials.PhysicianUsername}" TextColor="#333"/>
                                            <Span Text=" / " TextColor="#333"/>
                                            <Span Text="{x:Static bootstrap:SampleCredentials.PhysicianPassword}" TextColor="#333"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label Grid.Row="2" Grid.Column="0" Text="Patient:" FontSize="11" FontAttributes="Bold" TextColor="#333"/>
                                <Label Grid.Row="2" Grid.Column="1" FontSize="11" TextColor="#333">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{x:Static bootstrap:SampleCredentials.PatientUsername}" TextColor="#333"/>
                                            <Span Text=" / " TextColor="#333"/>
                                            <Span Text="{x:Static bootstrap:SampleCredentials.PatientPassword}" TextColor="#333"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                </VerticalStackLayout>

            </Border>

        </Grid>
    </ScrollView>

</ContentPage>
